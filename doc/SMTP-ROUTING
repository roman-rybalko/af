Входящий роутинг

-> - redirect_router
=> - errors_to
() - defaults
[] - condition
{} - unseen

* service [@services] {false} => error
* mailproc [flag_mailproc] {false} (-> service) => error
* hamtrap [flag_hamtrap] {true} (-> service) => error
* spamtrap [spamtrap_msg] {true} (-> service) => error
* spam [spamtrap_msg] {!client_spam_block} -> backup => error
* backup {true} -> mx => error
* mx {false} => bounce
* submission {false} => error

Для spam проверять afUSMTPDMBIsAbsent,
т.к. отправка производится с адреса afUSMTPDMailBox,
нет возможности отправлять с несуществующего адреса.
Нет смысла проверять для backup и mx (теоретически)
т.к. несуществующий MailBox до этих роутеров не дойдет:
если включен spamtrap, то сообщение поглотит spam_last_router,
если spamtrap отключен, тогда будет отвергнут RCPT.

Была идея пересылать выходящее сообщение на соседний smtp в случае недоставки.
Нужно предотвратить пересылку сообщения spam- или backup-роутером, для этого добавлять заголовок. Этот заголовок нужно
учитывать только при получении сообщения с соседнего smtp и удалять его при передаче клиенту.
Но это ломает retry rules и неконтролируемо добавляет trace headers (Received).
Этот функционал требуется для вывода сервера из работы.
Для вывода из работы достаточно изменить конфигурацию - сделать единственный роутер для отправки на соседний smtp.
Дублированием отправки в spam и backup можно принебречь (до тех пор, когда, по каким либо причинам, выводы из работы
станут регулярными - тогда реализовать заголовок).

Спам имеет смысл пропускать на клиента если он использует наши заголовки для фильтрации.
