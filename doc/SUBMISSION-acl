* локальные порты 25 587

* получение системной настройки размера сообщения для отключения проверки спама
sys_trustedmessagesize

* получить системную настройку максимаьного размера сообщения
sys_maxmessagesize

* получить системную настройку периода перепроверки ящика
sys_mailboxtimeout

* наш hostname
** наш realm и service=smtp
** проверен hostname (ptr <-> ip)
sys_trustedhost

* установить сертификат
** sys_trustedhost => наш сертификат
** client (IP)

* идентифицировать клиента
** sys_trustedhost
** SMTP AUTH
** TLS SNI
** IP

mail
* проверить доступ клиента к домену
* проверить существование адреса отправителя
** fail => 4xx Your data is verifying, try again later, log, stop
** absent => 5xx Sender mail box does not exist, stop
** ok
* !sys_trustedhost => проверить настройки аутентификации для пользователя, домена и клиента
** SMTP AUTH
** TLS SNI
** IP

rcpt
* проверить существование домена получателя

data_end
* проверить адрес отправителя
** нет домена => 5xx The domain is not in service, stop
** не наш realm => 4xx Moved, try another host, stop
** fail => 4xx Your data is verifying, try again later, log, stop
** ok, absent => 5xx Sender mail box does not exist, stop
** ok
* проверить message-id
(message-id всегда добавляется для этого соединеия)
** sender в БД => 2xx duplicate prev-queue-id, discard, stop
** sender в БД но другой => 5xx actual_sender prev-queue-id
** ok
* usr_hidereceived => убрать заголовки Received
* msgsize >= sys_trustedmessagesize => log (trusted size), ok, stop
