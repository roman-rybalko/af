Прием на портах 25 137 138 139 445.
Порт 587 - проверка адреса для submission, наш сертификат, проверка по нашему ЦС, отключены RBL SPF и прочий антиспам, укороченный таймаут для ящика.
Spam Trap - отправка сообщений в spamtrap с вероятностью из системных настроек.
Системные и пользовательские ч/б списки. ч/б списки по IP, hostname, адресу отправителя в сессии, полю Subject сертификата. Проверка сначала черного списка затем белого.
Пользовательские ч/б списки для клиента, домена и ящика.
MX для клиента, домена и ящика.

TODO: отправка спама в ящик (дописывать mailbox+ к email@domain)
TODO: ETRN внешняя утилита
TODO: rating

Проблема:
Как реализовать политики пользователя - сообщение может напрявляться нескольким пользователям и у них могут быть конфликтующие политики.
Часть пользователей приняли сообщение, часть отвергли.
1. Что вернуть отправителю (2xx, 4xx, 5xx)?
2. Обработать повторную доставку сообщения тому-же пользователю.
Решено: для снижения потребления ресурсов отвергать сообщение если отверг хоть один пользователь,
уведомлять отправителя какие пользователи отвергли сообщение.